# Modbus ICS attack demonstration

This project demonstrates basic industrial control system (ICS) security vulnerabilities using a simulated wind 
turbine PLC and Modbus/TCP protocol.

## Disclaimer

This demonstration is for **educational purposes only** to understand ICS security risks. Only use these tools on 
systems you own or have explicit permission to test. Unauthorised access to industrial control systems is illegal and 
dangerous.

## Prerequisites

```bash
pip install pymodbus==3.11.4
```

## Architecture

The simulator creates a virtual PLC with the following Modbus register map:

| Register Type    | Address | Purpose                     | Initial Value |
|------------------|---------|-----------------------------|---------------|
| Holding Register | 1000    | Speed setpoint (RPM)        | 1500          |
| Holding Register | 1050    | Temperature alarm threshold | 95            |
| Holding Register | 1100    | Emergency stop flag         | 0             |
| Input Register   | 2000    | Current speed (RPM)         | 1498          |
| Input Register   | 2050    | Current temperature (°C)    | 72            |

## Usage

### Start the simulator

In one terminal, start the turbine simulator:

```bash
python3 modbus_turbine_simulator.py
```

You should see:
```
[*] UU P&L Turbine PLC simulator running
[*] Listening on 0.0.0.0:502
```

**Note:** Port 502 is the standard Modbus port and requires root/administrator privileges on most systems. If you get 
a permission error, either:

```bash
sudo python3 modbus_turbine_simulator.py
```

Or modify the code to use a non-privileged port like 5020:

```python
StartTcpServer(context=context, address=("0.0.0.0", 5020))
```

### Run the attack demonstration

In a second terminal, run the attack script:

```bash
python3 modbus_shutdown_attack_demo.py
```

Expected output:
```
[*] Connected to target
Current speed: 1498 RPM
Current setpoint: 1500 RPM
[*] Writing zero to speed setpoint (attack)
[✓] Write succeeded
New setpoint: 0 RPM
```

The attack script demonstrates a common ICS vulnerability:

1. **No Authentication** - The Modbus protocol has no built-in authentication
2. **Unauthorised Write Access** - Anyone who can connect can modify critical setpoints
3. **Physical Impact** - Setting turbine speed to 0 RPM could cause:
   - Emergency shutdown
   - Mechanical stress from rapid deceleration
   - Loss of power generation
   - Potential equipment damage

## Real-world context

This simple attack represents actual vulnerabilities found in industrial systems:

- **Stuxnet (2010)** - Modified PLC code to damage Iranian centrifuges
- **Ukraine Power Grid (2015)** - Attackers remotely opened circuit breakers
- **TRITON/TRISIS (2017)** - Targeted safety systems at a petrochemical plant

## Security mitigations

To protect against these attacks, industrial facilities should:

1. **Network segmentation** - Isolate ICS networks from IT networks and the internet
2. **Firewall rules** - Only allow specific IPs to access Modbus devices
3. **VPN/Authentication** - Use encrypted tunnels and authentication layers
4. **Monitoring** - Log all Modbus traffic and alert on unexpected writes
5. **Physical security** - Secure access to control rooms and network equipment
6. **Read-Only access** - Where possible, restrict devices to read-only operations

## Run the data exfiltration demo

```bash
python3 ics_data_exfiltration_demo.py
```

Expected output (IF the simulator is running):

```
======================================================================
[*] Proof of Concept: Unauthorised Turbine Configuration Access
[*] This is a READ-ONLY demonstration
======================================================================

[*] Reading configuration from Turbine 1 (Demo) (127.0.0.1)...
    Speed Setpoint: 1500 RPM
    Current Speed: 1498 RPM
    Temperature Alarm: 95°C
    Current Temperature: 72°C
    E-Stop Active: False
    Temperature Safety Margin: 23°C

[*] ==================================================================
[*] Results saved to poc_turbine_read_20251215_143022.json
[*] No modifications were made to any systems
[*] This demonstrates read-only reconnaissance capability
[*] ==================================================================

[*] IMPACT SUMMARY:
----------------------------------------------------------------------
    An attacker with this access could:
    • Monitor real-time operational state
    • Map system architecture and register layout
    • Identify safety thresholds to stay below during attacks
    • Collect baseline data for anomaly detection evasion
    • Plan precisely-timed manipulation attacks
    • Steal proprietary operational parameters
```

And the generated JSON file:

```
{
  "timestamp": "2025-12-15T14:30:22.145678",
  "demonstration": "read_only_turbine_access",
  "turbines_scanned": 1,
  "successful_reads": 1,
  "turbines": {
    "Turbine 1 (Demo)": {
      "speed_setpoint_rpm": 1500,
      "temp_alarm_threshold_c": 95,
      "emergency_stop_active": false,
      "current_speed_rpm": 1498,
      "current_temperature_c": 72
    }
  },
  "impact_assessment": {
    "data_exposure": [
      "Operational setpoints and safety thresholds exposed",
      "Real-time operational state visible to unauthorized parties",
      "Safety margins and alarm thresholds revealed",
      "System architecture and register mapping discovered"
    ],
    "attack_enablement": [
      "Attacker could monitor operational states in real-time",
      "Configuration data reveals safety margins and operational limits",
      "Historical data collection could reveal production schedules",
      "Information enables planning of precise manipulation attacks",
      "Baseline establishment allows detection of anomalies attackers create"
    ],
    "business_impact": [
      "Intellectual property theft (operational parameters)",
      "Competitive intelligence (production efficiency)",
      "Safety information leakage enables targeted attacks",
      "Regulatory compliance violations (unauthorized access)"
    ]
  }
}
```

If the simulator is NOT running, you'll see:

```
======================================================================
[*] Proof of Concept: Unauthorised Turbine Configuration Access
[*] This is a READ-ONLY demonstration
======================================================================

[*] Reading configuration from Turbine 1 (Demo) (127.0.0.1)...
    [!] Failed to connect to 127.0.0.1
    [!] Could not read from Turbine 1 (Demo)

[!] No turbines were accessible. Ensure the simulator is running:
    python3 turbine_simulator.py
```

### Run historian exfiltration demo

```bash
python3 historian_exfiltration.py
```

Expected output (when no database is available):

```
======================================================================
[*] Proof of Concept: Historian Data Exfiltration
[*] READ-ONLY demonstration - no operational impact
======================================================================

[*] Connecting to historian at 192.168.3.10...
[*] Querying last 365 days of data...
[!] Database connection failed: [IM002] [Microsoft][ODBC Driver Manager] Data source name not found and no default driver specified
[!] This is expected if no historian database is available

[*] In a real scenario, this would extract:
    • Years of production data
    • Efficiency metrics and trends
    • Maintenance and downtime records
    • Alarm histories and patterns
    • Operational setpoint changes over time
```

If database was available:

```
======================================================================
[*] Proof of Concept: Historian Data Exfiltration
[*] READ-ONLY demonstration - no operational impact
======================================================================

[*] Connecting to historian at 192.168.3.10...
[*] Querying last 365 days of data...
[*] Extracted 876543 records
[*] Data saved to exfiltrated_production_data_20251215_143500.csv

[*] VALUE OF THIS DATA:
    - Reveals production capacity and efficiency
    - Identifies operational patterns and schedules
    - Shows improvement trends over time
    - Competitive intelligence worth €€€ to rivals
    - Historical baselines enable stealthy manipulation
    - Maintenance schedules reveal vulnerability windows
```

### Run PLC ladder logic extraction demo

```bash
python3 plc_logic_extraction.py
```

Expected output (without real PLC):
```
======================================================================
[*] Proof of Concept: PLC Ladder Logic Extraction
[*] Demonstrates intellectual property theft capability
======================================================================

[*] Connecting to Allen-Bradley PLC at 192.168.10.10...
[!] Connection failed: [Errno 111] Connection refused

[*] Note: This PoC requires an actual Allen-Bradley PLC
[*] pycomm3 works with CompactLogix, ControlLogix PLCs

[*] In a real scenario, this extraction would provide:
    • Complete ladder logic programs (.L5K/.ACD files)
    • All process control algorithms
    • Safety interlock logic
    • HMI tag mappings
    • Network configuration
    • User-defined function blocks

[*] Tools used in real attacks:
    • RSLogix 5000 / Studio 5000 (legitimate tools)
    • pycomm3 (Python library for AB PLCs)
    • Custom protocol reverse engineering
    • Network traffic capture and replay

======================================================================
[*] EXAMPLE: What Attackers Learn from Ladder Logic
======================================================================

[*] Safety Interlocks Discovered:
    • Emergency stop circuit on input I:1/0
    • Temperature > 95C triggers shutdown
    • Pressure relief valve opens at 150 PSI
    • Redundant safety logic requires 2-of-3 sensor agreement

[*] Proprietary Process Parameters:
    • Proprietary mixing algorithm with 7-stage process
    • Temperature ramp rate: 2.5°C/min for optimal yield
    • Pressure hold time: 45 seconds at each stage
    • Custom PID tuning parameters (Kp=1.2, Ki=0.8, Kd=0.3)

[*] Attack Vectors Identified:
    • Safety logic can be bypassed via register 1100
    • Alarm thresholds stored in unprotected memory
    • No authentication on remote I/O modules
    • Watchdog timer can be disabled via bit B3:0/5

======================================================================
```

### Run demo on slow exfiltration

```bash
python3 covert_exfiltration.py
```

Expected output:

```
======================================================================
[*] Proof of Concept: Covert Data Exfiltration
[*] Demonstrates techniques to evade detection
======================================================================

[*] Sample data to exfiltrate:
    Type: Production records
    Size: 281 bytes
    Value: Trade secrets, competitive intelligence

----------------------------------------------------------------------
[*] METHOD 1: DNS Tunneling
----------------------------------------------------------------------
[*] DNS Exfiltration to exfil.attacker.com
[*] Data size: 200 bytes
[*] Sending 5 DNS queries...
    Sent 5/5 queries
[*] DNS exfiltration complete
[*] Detection evasion: Appears as normal DNS lookups

----------------------------------------------------------------------
[*] METHOD 2: HTTPS Upload
----------------------------------------------------------------------
[*] HTTPS Exfiltration to https://legit-looking-domain.com/api/upload
[*] Data size: 281 bytes
[*] Upload simulated (server not reachable)
[*] In real attack, data would be uploaded via HTTPS
[*] Detection evasion: Encrypted, looks like normal web traffic

----------------------------------------------------------------------
[*] METHOD 3: Time-Based Rate Limiting
----------------------------------------------------------------------
[*] Slow Exfiltration (Rate-limited)
[*] Total data size: 1000 bytes (0.98 KB)
[*] Rate limit: 100 KB/hour
[*] Will send 1 chunks
[*] Estimated time: 1 hours (0.0 days)
[*] Detection probability: LOW (spread over time)

[*] Simulating first 3 chunks...
    [2025-12-15 14:45:23] Chunk 1/1: 1000 bytes

[*] Slow exfiltration initiated
[*] Detection evasion: Traffic blends with normal activity

[*] For 10 MB dataset:
    Time required: 102 hours (4.3 days)
    Detection risk: Minimal (blends with background)

======================================================================
[*] DETECTION EVASION TECHNIQUES SUMMARY
======================================================================

Method               Stealth      Speed        Evasion Technique
----------------------------------------------------------------------
DNS Tunneling        HIGH         SLOW         Appears as normal DNS lookups
HTTPS Upload         MEDIUM       FAST         Encrypted, blends with web traffic
Rate-Limited         VERY HIGH    VERY SLOW    Small periodic transfers avoid DLP triggers
ICMP Tunneling       HIGH         SLOW         Hidden in ping packets (not implemented)
Steganography        VERY HIGH    MEDIUM       Hidden in image files (not implemented)

[*] DEFENSIVE COUNTERMEASURES:
    • Monitor DNS query volumes and patterns
    • Inspect HTTPS traffic via SSL/TLS interception
    • Implement data loss prevention (DLP) systems
    • Baseline normal traffic patterns
    • Monitor for slow, persistent outbound connections
    • Restrict outbound connections to approved destinations

======================================================================
```

### Turbine emergency stop simulation

```bash
python3 turbine_emergency_stop.py
```

Expected output with simulator running:
```
======================================================================
[!] WARNING: DESTRUCTIVE OPERATION
[!] This will modify turbine setpoints
======================================================================

[*] Targeting turbine at 127.0.0.1...
    Current setpoint: 1500 RPM
    [✓] Emergency stop executed
    New setpoint: 0 RPM

======================================================================
[*] ATTACK SUMMARY
======================================================================
Turbines targeted: 1
Successful attacks: 1
Failed attacks: 0

[*] IMPACT:
    • 1 turbine(s) forced to emergency stop
    • Immediate loss of power generation
    • Potential mechanical damage from rapid deceleration
    • Grid stability impact
    • Manual restart required

[*] DETECTION:
    • SCADA alarms would trigger immediately
    • Sudden loss of generation visible
    • However, attack takes only seconds
    • Damage may already be done before response
```

### Turbine overspeed attack demo

```bash
python3 turbine_overspeed_attack.py
```

Expected output (abbreviated):
```
======================================================================
[!] CRITICAL WARNING: EXTREMELY DESTRUCTIVE OPERATION
[!] This attack could cause PHYSICAL DAMAGE to equipment
[!] Real turbines could be DESTROYED by overspeed
======================================================================

[*] Target: 127.0.0.1
[*] Current speed: 1500 RPM (normal)
[*] Target speed: 1650 RPM (10.0% overspeed)
[*] Increment: 5 RPM per step
[*] Delay: 1 seconds per step
[*] Total steps: 30
[*] Estimated duration: 30 seconds (0.5 minutes)
[*] Attack profile: SLOW and STEALTHY

[*] Connected to turbine PLC
[*] Initial setpoint: 1500 RPM
[*] Initial actual speed: 1498 RPM

[*] Beginning gradual overspeed attack at 14:52:30
----------------------------------------------------------------------
[14:52:30] Step 1/30: Setpoint = 1500 RPM (+0.0%) | Actual = 1498 RPM
[14:52:31] Step 2/30: Setpoint = 1505 RPM (+0.3%) | Actual = 1498 RPM
[14:52:32] Step 3/30: Setpoint = 1510 RPM (+0.7%) | Actual = 1498 RPM
...
[14:52:59] Step 30/30: Setpoint = 1650 RPM (+10.0%) | Actual = 1498 RPM
----------------------------------------------------------------------
[*] Attack complete at 14:52:59

[*] FINAL STATE:
    Final setpoint: 1650 RPM
    Final actual speed: 1498 RPM

[*] PHYSICAL DAMAGE ASSESSMENT:
    • Overspeed: 10.0% above normal
    • Centrifugal forces increased by ~21%
    • Potential outcomes:
      - Blade structural failure
      - Bearing damage from excessive loads
      - Gearbox destruction
      - Generator failure
      - Catastrophic turbine disintegration
      - Safety system damage if bypassed

[*] ATTACK CHARACTERISTICS:
    • Gradual: Changes small enough to avoid immediate alarms
    • Stealthy: Slow progression appears operational
    • Persistent: Maintained over 0.5 minutes
    • Destructive: Physical damage may be irreversible
```

### Protocol camouflage attack demo

```bash
python3 protocol_camouflage.py
```

Expected output:
```
======================================================================
[*] Proof of Concept: Protocol Camouflage
[*] Comparing suspicious vs. evasive attack methods
======================================================================

[*] SCENARIO: Attacker wants to trigger emergency stop
[*] Target: 192.168.10.10
[*] Malicious action: Set speed to 0 RPM

----------------------------------------------------------------------
[*] METHOD 1: Raw Modbus Attack (HIGH detection probability)
----------------------------------------------------------------------
[*] Standard Modbus write to 192.168.10.10
    Register: 1000
    Value: 0
    Method: Raw Modbus/TCP
    [!] Connection failed

    Detection characteristics:
    • Raw Modbus/TCP commands in network traffic
    • No authentication or session management
    • Unusual source IP or timing
    • IDS signatures for Modbus anomalies
    • Lacks legitimate engineering software fingerprint

----------------------------------------------------------------------
[*] METHOD 2: Camouflaged Attack (LOW detection probability)
----------------------------------------------------------------------
[*] Evasive write to 192.168.10.10
    Tag: SpeedSetpoint
    Value: 0
    Method: Allen-Bradley EtherNet/IP (legitimate protocol)
    [!] Error: ...
    Note: This requires an Allen-Bradley PLC with EtherNet/IP

    Detection evasion characteristics:
    • Uses Allen-Bradley EtherNet/IP protocol
    • Identical to RSLogix/Studio 5000 traffic
    • Includes proper session management
    • Tagged data access (not raw registers)
    • Appears as legitimate engineering work
    • May include valid engineering credentials

======================================================================
[*] DETECTION COMPARISON
======================================================================

Aspect               Suspicious Method              Evasive Method                
----------------------------------------------------------------------------------
Network signature    Raw Modbus function codes      Legitimate vendor protocol    
Authentication       None (Modbus has no auth)      May use stolen credentials    
Session handling     Simple connect/write/close     Full session management       
IDS detection        HIGH - triggers anomaly rules  LOW - looks legitimate        
Log appearance       "Unauthorized Modbus write"    "Engineer modified setpoint"  
Investigation        Immediately suspicious         Requires credential audit     

[*] REAL-WORLD EXAMPLES:
    • Stuxnet used legitimate Siemens Step 7 protocols
    • TRITON/TRISIS mimicked Schneider Electric software
    • Attackers steal engineering workstation credentials
    • VPN access from compromised engineering laptops
```

### Security monitoring validation

```bash
python3 ids_detection_test.py
```

Expected output:
```
======================================================================
[*] IDS Detection Validation Test Suite
[*] Purpose: Verify security monitoring effectiveness
======================================================================

[!] WARNING: These tests generate security alerts
[!] Ensure you have authorization before proceeding
[!] Coordinate with SOC to expect test traffic

======================================================================
[*] IDS Detection Test: Port Scanning
======================================================================
[*] Target: 192.168.10.0/24
[*] Time: 2025-12-15 15:30:45
[*] Expected IDS signature: SCAN NMAP TCP
[*] Expected severity: MEDIUM to HIGH

[*] Performing aggressive TCP SYN scan...
    Scan type: TCP SYN (-sS)
    Timing: Aggressive (-T4)
    Ports: 1-1000
    This is deliberately NOISY to test detection

[*] Scan complete in 45.3 seconds
[*] Hosts scanned: 3

[*] Discovered hosts:
    192.168.10.10 - up
        Open ports: 502, 102
    192.168.10.11 - up
        Open ports: 502
    192.168.10.12 - up
        Open ports: 502, 20000

[*] EXPECTED DETECTION:
    ✓ IDS should log scan activity
    ✓ Alert should be generated
    ✓ Email/ticket to security team
    ✓ SIEM correlation of scan events

[*] VERIFICATION CHECKLIST:
    1. Check IDS logs at 15:30:45
    2. Check security mailbox (security@uupl.edu)
    3. Check SIEM for correlated events
    4. Interview SOC: Did they see this scan?
    5. Interview SOC: Did they investigate?
    6. Interview SOC: What was their response time?
```

### Security monitoring validation

1. First configure the simulator:

```text
# ============================================================================
# CONFIGURATION FOR TURBINE SIMULATOR
# ============================================================================

CONFIG = {
    # VPN Configuration
    'vpn': {
        'server': '192.168.1.1',
        'username': 'testuser',
        'password': 'testpass123',
        'simulate': True  # Keep as True - we're only testing Modbus
    },
    
    # Jump Server (SSH Brute Force Target)
    'jump_server': {
        'ip': '127.0.0.1',  # Local SSH server if you have one
        'port': 22,
        'valid_username': 'admin',
        'valid_password': 'admin123',
        'invalid_passwords': [
            'password', '123456', 'admin', 'letmein', 'qwerty'
        ]
    },
    
    # Engineering Workstation
    'engineering_ws': {
        'ip': '127.0.0.1',
        'rdp_port': 3389,
        'username': 'engineer',
        'password': 'eng123'
    },
    
    # PLC Configuration Files to Access
    'plc_files': {
        'server': '127.0.0.1',
        'paths': [
            '/tmp/turbine_control.l5k',
            '/tmp/scada_config.xml',
            '/tmp/hmi_project.zip'
        ]
    },
    
    # OT Network - CONFIGURED FOR TURBINE SIMULATOR
    'ot_network': {
        'subnet': '127.0.0.1/32',
        'plc_ips': [
            '127.0.0.1',  # Our turbine simulator
            # Add more if you run multiple simulators on different ports
        ]
    },
    
    # Test Settings
    'delays': {
        'between_steps': 2,      # Shorter delays for local testing
        'failed_login': 1,        
        'modbus_write': 1         
    },
    
    # Logging
    'log_to_syslog': False,  # Set True if you have syslog server
    'syslog_server': '192.168.1.100',
    'save_pcap': False
}
```

2. Start simulator

```bash
python3 modbus_turbine_simulator.py
```

3. Run the attack chain:

```bash
python3 siem_correlation_test.py
```

What will happen:

1. **Steps 1-4** will be simulated (VPN, SSH, RDP, file access)
2. **Step 5** will actually scan `127.0.0.1:502` and find the simulator
3. **Step 6** will establish a real Modbus connection to the simulator
4. **Step 7** will perform actual Modbus WRITE operations:
   - Read current setpoint (1500 RPM)
   - Write new value (1501 RPM)
   - Verify the write
   - Restore original value (1500 RPM)

Expected output for Steps 5-7:

```
======================================================================
[*] STEP 5: OT Network Reconnaissance
======================================================================
[*] Scanning subnet: 127.0.0.1/32
[*] Scanning 127.0.0.1... ONLINE - Modbus port open
[*] Discovered 1 PLC(s)

======================================================================
[*] STEP 6: Modbus PLC Connections
======================================================================
[*] Connecting to 127.0.0.1:502... CONNECTED
    Read registers: [1500, 95, 0, 0, 0]
[*] Established 1 Modbus connection(s)

======================================================================
[*] STEP 7: Modbus WRITE Commands (CRITICAL)
======================================================================
[!] WARNING: This will MODIFY PLC setpoints!

[*] Target PLC: 127.0.0.1
    Current setpoint: 1500
    Writing new value: 1501... SUCCESS
    Restoring original value... RESTORED

[*] Completed 1 write operation(s)
```

### Anomaly Detection Bypass Test

```
# Terminal 1
python3 modbus_turbine_simulator.py

# Terminal 2
python3 anomaly_bypass_test.py
```

## License

These educational demonstrations are provided as-is for learning purposes only.
